---
phase: v1.2-06
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/src/content/docs/api/index.md
  - docs/src/content/docs/api/request.md
  - docs/src/content/docs/api/response.md
  - docs/src/content/docs/api/headers.md
  - docs/src/content/docs/api/fetch.md
  - docs/src/content/docs/api/url.md
  - docs/src/content/docs/api/timers.md
  - docs/src/content/docs/api/console.md
  - docs/src/content/docs/api/crypto.md
  - docs/src/content/docs/api/encoding.md
  - docs/src/content/docs/api/streams.md
  - docs/src/content/docs/api/blob.md
  - docs/src/content/docs/api/abort.md
  - docs/src/content/docs/api/limitations.md
  - docs/src/content/docs/wintercg/index.md
  - docs/src/content/docs/wintercg/compliance-notes.md
  - docs/src/content/docs/wintercg/diffs-from-workers.md
  - docs/src/content/docs/deployment/index.md
  - docs/src/content/docs/deployment/self-hosted.md
  - docs/src/content/docs/deployment/nginx.md
  - docs/src/content/docs/deployment/caddy.md
  - docs/src/content/docs/deployment/systemd.md
  - docs/src/content/docs/deployment/graceful-shutdown.md
autonomous: true

must_haves:
  truths:
    - "User can find API documentation for all Workers-compatible APIs (Request, Response, Headers, fetch, etc.)"
    - "User understands which WinterCG APIs are supported and which have limitations"
    - "User can deploy NANO to production with Nginx or Caddy reverse proxy"
    - "User knows about known limitations (buffer limits, sync fetch, etc.)"
  artifacts:
    - path: "docs/src/content/docs/api/request.md"
      provides: "Request object API reference"
      contains: "request.url()"
      min_lines: 50
    - path: "docs/src/content/docs/api/response.md"
      provides: "Response object API reference"
      contains: "Response.json"
      min_lines: 60
    - path: "docs/src/content/docs/api/streams.md"
      provides: "ReadableStream/WritableStream documentation"
      contains: "ReadableStream"
      min_lines: 80
    - path: "docs/src/content/docs/api/limitations.md"
      provides: "Known limitations from BACKLOG.md"
      contains: "B-01"
      min_lines: 60
    - path: "docs/src/content/docs/deployment/nginx.md"
      provides: "Nginx reverse proxy setup guide"
      contains: "upstream nano"
      min_lines: 60
    - path: "docs/src/content/docs/wintercg/compliance-notes.md"
      provides: "WinterCG compliance status"
      contains: "WinterCG"
      min_lines: 40
  key_links:
    - from: "docs/src/content/docs/api/*.md"
      to: "code examples"
      via: "javascript code blocks"
      pattern: "```javascript.*export default"
    - from: "docs/src/content/docs/deployment/nginx.md"
      to: "nginx config"
      via: "nginx code block"
      pattern: "```nginx"
    - from: "docs/src/content/docs/api/limitations.md"
      to: "BACKLOG.md items"
      via: "B-01 through B-08 references"
      pattern: "B-0[1-8]"
---

<objective>
Complete NANO's documentation with comprehensive API reference, WinterCG compliance notes, known limitations, and production deployment guides.

Purpose: Provide complete reference documentation so users can understand NANO's API surface, compliance status, and production deployment without consulting source code.

Output: Full API documentation for all Workers-compatible APIs, WinterCG compliance documentation, deployment guides for Nginx/Caddy/systemd, and limitations reference.
</objective>

<execution_context>
@/Users/gleicon/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gleicon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/gleicon/code/zig/nano/.planning/PROJECT.md
@/Users/gleicon/code/zig/nano/.planning/ROADMAP.md
@/Users/gleicon/code/zig/nano/.planning/STATE.md
@/Users/gleicon/code/zig/nano/.planning/phases/v1.2-06-documentation-site/v1.2-06-RESEARCH.md
@/Users/gleicon/code/zig/nano/.planning/BACKLOG.md
@/Users/gleicon/code/zig/nano/test/cloudflare-worker/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write API reference documentation</name>
  <files>
    docs/src/content/docs/api/index.md
    docs/src/content/docs/api/request.md
    docs/src/content/docs/api/response.md
    docs/src/content/docs/api/headers.md
    docs/src/content/docs/api/fetch.md
    docs/src/content/docs/api/url.md
    docs/src/content/docs/api/timers.md
    docs/src/content/docs/api/console.md
    docs/src/content/docs/api/crypto.md
    docs/src/content/docs/api/encoding.md
    docs/src/content/docs/api/streams.md
    docs/src/content/docs/api/blob.md
    docs/src/content/docs/api/abort.md
    docs/src/content/docs/api/limitations.md
  </files>
  <action>
Create comprehensive API documentation for all NANO APIs. Each page should follow this pattern:
- Brief description
- Properties section (with getter notation where applicable)
- Methods section (with signatures and examples)
- Working code examples from test/cloudflare-worker/index.js patterns
- WinterCG compliance notes (using :::note for method vs property differences)
- Frontmatter with sidebar.order and optional sidebar.badge for WinterCG compliance

**api/index.md**: Overview of NANO's API surface, organization by category (HTTP, Streams, Crypto, Encoding, Utilities), link to limitations page.

**api/request.md**:
- Properties: url() (method), method() (method), headers() (method) - note these are methods not properties per WinterCG
- Methods: text(), json()
- Note about body consumption (can only call once)
- Example from cloudflare-worker test

**api/response.md**:
- Properties: status, ok, statusText, headers, body (ReadableStream getter)
- Methods: text(), json()
- Static methods: Response.json(), Response.redirect()
- Constructor with status and headers options
- Example creating JSON response
- Note about Response.body returning ReadableStream

**api/headers.md**:
- Methods: get(), set(), has(), delete(), append(), entries(), forEach()
- Note about append() using comma-separated values per WHATWG spec
- Note about delete() properly removing keys (not setting to undefined)
- Multi-value header example with Set-Cookie

**api/fetch.md**:
- fetch(url, options) signature
- Supported methods: GET, POST, PUT, DELETE
- Headers and body options
- Example POST with JSON body
- :::caution about synchronous fetch blocking event loop (B-02 limitation)
- Note about 64KB body limit (B-01 limitation)

**api/url.md**:
- Constructor: new URL(string)
- Properties: href, origin, protocol, host, hostname, port, pathname, search, hash (all getters)
- Method: toString()
- Example parsing request URL
- Note about read-only properties (B-08 limitation)

**api/timers.md**:
- setTimeout(fn, ms), setInterval(fn, ms)
- clearTimeout(id), clearInterval(id)
- Note about iteration-based timing (not wall-clock)
- Example with cleanup

**api/console.md**:
- Methods: log(), warn(), error(), info(), debug()
- Note about object inspection using JSON.stringify (not [object Object])
- 4KB per-value buffer limit (B-01 limitation)

**api/crypto.md**:
- crypto.randomUUID()
- crypto.getRandomValues(typedArray)
- crypto.subtle.digest(algorithm, data) - supports SHA-256, SHA-384, SHA-512
- crypto.subtle.sign(algorithm, key, data) - HMAC only
- crypto.subtle.verify(algorithm, key, signature, data) - HMAC only
- Example hashing with SHA-256 from cloudflare-worker test
- Note about limited crypto.subtle (B-04 limitation - no RSA/ECDSA/AES)

**api/encoding.md**:
- TextEncoder: encode(string) returns Uint8Array
- TextDecoder: decode(buffer) returns string
- atob(base64) and btoa(string) for base64
- Note about 8KB buffer limit for atob/btoa (B-01 limitation)

**api/streams.md**:
- ReadableStream: constructor with pull/start/cancel callbacks, getReader(), locked property, tee()
- WritableStream: constructor with write/close/abort sinks, getWriter(), locked property
- TransformStream: readable, writable properties, constructor
- Note about WritableStream sync-only sinks (B-03 limitation)
- Note about tee() data loss issue (B-05 limitation)
- Example creating ReadableStream with controller.enqueue()

**api/blob.md**:
- Blob properties: size, type (getters)
- Blob methods: text(), arrayBuffer(), slice()
- Blob constructor accepts strings, ArrayBuffer, Uint8Array
- File extends Blob with name, lastModified properties
- Note about 64KB constructor limit (B-01 limitation)

**api/abort.md**:
- AbortController: constructor, signal property (getter), abort() method
- AbortSignal: aborted property (getter), static AbortSignal.timeout(ms)
- Example with fetch abort
- Note about DOMException replaced with Error (name="TimeoutError")

**api/limitations.md**:
- Document all B-01 through B-08 items from BACKLOG.md
- For each: severity, what's affected, workaround (if any), planned fix (v1.3 TBD)
- Use tables for buffer limits
- :::caution for high-severity items (B-01, B-02)
- Link to GitHub issues if available

Use code examples liberally. Every API should have at least one working example. Use :::note for WinterCG compliance differences, :::caution for limitations.
  </action>
  <verify>
```bash
cd /Users/gleicon/code/zig/nano/docs
npm run build
```
Build succeeds. Check dist/ output for all API pages. Verify:
- All 14 API pages exist in dist/api/
- Code blocks have syntax highlighting
- Internal links work (no 404s)
- Search finds API methods (search for "fetch", "Response.json")
  </verify>
  <done>
- 14 API documentation pages created with proper frontmatter
- Each page documents properties, methods, with examples
- limitations.md documents all B-01 through B-08 items
- All code examples use proper language tags
- Build succeeds without broken links
  </done>
</task>

<task type="auto">
  <name>Task 2: Write WinterCG compliance documentation</name>
  <files>
    docs/src/content/docs/wintercg/index.md
    docs/src/content/docs/wintercg/compliance-notes.md
    docs/src/content/docs/wintercg/diffs-from-workers.md
  </files>
  <action>
Create WinterCG compliance documentation:

**wintercg/index.md**:
- What is WinterCG (Web-interoperable Runtimes Community Group)
- Why NANO follows WinterCG specs
- Overview of supported APIs
- Link to compliance-notes and diffs-from-workers
- Frontmatter: title "WinterCG Compliance", sidebar.order: 1

**wintercg/compliance-notes.md**:
- Table of WinterCG APIs with support status
- Fully supported: Request, Response, Headers, fetch, URL, Blob, File, ReadableStream, WritableStream, TransformStream, crypto (partial), TextEncoder/TextDecoder, atob/btoa, console, setTimeout/setInterval, AbortController/AbortSignal
- Partially supported: crypto.subtle (HMAC + SHA digests only, not RSA/ECDSA/AES)
- Not supported: structuredClone, queueMicrotask, performance.now, EventTarget/Event, WebSocket, Cache, CompressionStream
- For each API: compliance level, notes about differences
- Link to /api/limitations for buffer limits and sync fetch
- Frontmatter: title "WinterCG Compliance Status", sidebar.order: 2

**wintercg/diffs-from-workers.md**:
- Comparison table: NANO vs Cloudflare Workers
- Key difference: properties-as-methods (request.url() not request.url, request.method() not request.method, etc.)
- Explain why: WinterCG spec compliance in v1.2-05
- Note: affects code portability - Workers code needs () added to property access
- Example migration pattern showing before/after
- Other differences: buffer limits, sync fetch, missing crypto algorithms
- Frontmatter: title "Differences from Cloudflare Workers", sidebar.order: 3

Use tables for compliance status. Use :::tip for migration hints. Reference API docs for details.
  </action>
  <verify>
```bash
cd /Users/gleicon/code/zig/nano/docs
npm run dev
```
Navigate to /wintercg/ and verify:
- All 3 pages render
- compliance-notes.md has table of all APIs
- diffs-from-workers.md shows property vs method difference clearly
- Links to /api/* work
  </verify>
  <done>
- Three WinterCG documentation pages created
- compliance-notes.md documents all APIs with support status
- diffs-from-workers.md explains property-as-method pattern
- All internal links work
  </done>
</task>

<task type="auto">
  <name>Task 3: Write deployment documentation</name>
  <files>
    docs/src/content/docs/deployment/index.md
    docs/src/content/docs/deployment/self-hosted.md
    docs/src/content/docs/deployment/nginx.md
    docs/src/content/docs/deployment/caddy.md
    docs/src/content/docs/deployment/systemd.md
    docs/src/content/docs/deployment/graceful-shutdown.md
  </files>
  <action>
Create production deployment guides:

**deployment/index.md**:
- Overview of deployment options
- Architecture: Nginx/Caddy → NANO on internal port
- Security considerations (don't expose NANO directly to internet)
- Navigation to nginx, caddy, systemd, graceful-shutdown
- Frontmatter: title "Deployment", sidebar.order: 1

**deployment/self-hosted.md**:
- Prerequisites: server with Zig or release binary
- Build NANO on server or copy binary
- Create config.json
- Test run: ./nano serve --config config.json
- Note about binding to 127.0.0.1 for reverse proxy
- Frontmatter: title "Self-Hosted Deployment", sidebar.order: 2

**deployment/nginx.md**:
- Full Nginx reverse proxy setup (use pattern from RESEARCH.md example 5)
- upstream nano block pointing to 127.0.0.1:3000
- SSL configuration with Let's Encrypt paths
- Security headers (HSTS, X-Content-Type-Options, X-Frame-Options)
- Gzip compression
- proxy_pass with required headers (Host, X-Real-IP, X-Forwarded-For)
- Timeout settings (must be >= NANO timeout)
- HTTP → HTTPS redirect
- Testing section with curl examples
- Frontmatter: title "Nginx Reverse Proxy", sidebar.order: 3

**deployment/caddy.md**:
- Caddy reverse proxy setup (simpler than Nginx)
- Caddyfile example with automatic HTTPS
- reverse_proxy directive to localhost:3000
- Header forwarding (automatic in Caddy)
- Testing section
- Frontmatter: title "Caddy Reverse Proxy", sidebar.order: 4

**deployment/systemd.md**:
- systemd service file for NANO
- [Unit] section with description
- [Service] section: ExecStart, WorkingDirectory, Restart=always, User, Environment
- [Install] section: WantedBy=multi-user.target
- Enable and start: sudo systemctl enable nano && sudo systemctl start nano
- Status check: sudo systemctl status nano
- Logs: sudo journalctl -u nano -f
- Frontmatter: title "systemd Service", sidebar.order: 5

**deployment/graceful-shutdown.md**:
- Explain SIGTERM/SIGINT handling in NANO
- Connection draining behavior (30s timeout)
- In-flight requests complete before shutdown
- Removing app via config watcher triggers per-app drain
- 503 Service Unavailable for draining apps
- Example shutdown workflow
- Note about drain timeout (not configurable in v1.2)
- Frontmatter: title "Graceful Shutdown", sidebar.order: 6

Use nginx and systemd code blocks. Include complete working configs. Use :::note for important operational details.
  </action>
  <verify>
```bash
cd /Users/gleicon/code/zig/nano/docs
npm run build
npm run preview
```
Navigate to /deployment/ and verify:
- All 6 deployment pages render
- nginx.md has complete working Nginx config
- caddy.md has working Caddyfile
- systemd.md has complete service file
- Code blocks have proper syntax highlighting
  </verify>
  <done>
- Six deployment documentation pages created
- nginx.md includes complete reverse proxy config with SSL
- caddy.md includes Caddyfile with automatic HTTPS
- systemd.md includes complete service file
- graceful-shutdown.md explains SIGTERM handling and drain behavior
- All configs are complete and copy-pasteable
  </done>
</task>

</tasks>

<verification>
**Complete build verification:**
```bash
cd /Users/gleicon/code/zig/nano/docs
npm run build
npm run preview
```

Verify all sections accessible:
- /api/ has 14 pages with all Workers-compatible APIs
- /wintercg/ has compliance status and differences from Workers
- /deployment/ has nginx, caddy, systemd guides

**Content completeness:**
- All B-01 through B-08 limitations documented in api/limitations.md
- All APIs from planning context documented (Request, Response, Headers, fetch, URL, Blob, File, AbortController, crypto, streams, timers, console, encoding)
- Nginx config includes SSL, security headers, timeouts
- WinterCG compliance table shows support status for all spec APIs

**Navigation verification:**
- Sidebar auto-generates all sections
- Search works (test: "fetch", "nginx", "limitations")
- All internal links work (no 404s)
- Code blocks have syntax highlighting

**Production build:**
```bash
cd /Users/gleicon/code/zig/nano/docs
npm run build
ls -lh dist/  # Verify dist folder created
```
</verification>

<success_criteria>
1. All Workers-compatible APIs documented with properties, methods, and examples
2. Known limitations (B-01 through B-08) documented in api/limitations.md
3. WinterCG compliance status documented with support table
4. Production deployment guides for Nginx and Caddy with complete configs
5. systemd service file documented for running as system service
6. Graceful shutdown behavior explained
7. Build succeeds and produces complete dist/ folder
8. Search indexes all pages and finds API methods
9. All code examples use proper syntax highlighting
10. Site ready for deployment to static hosting (Vercel, Netlify, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/v1.2-06-documentation-site/v1.2-06-02-SUMMARY.md` with:
- Total pages created count (should be ~30+ markdown files)
- API reference completeness (all 14 API pages)
- Deployment guide completeness (nginx, caddy, systemd)
- Build stats (dist/ folder size, page count)
- Next steps: Deploy to static hosting (optional), announce documentation site
</output>
