---
phase: v1.2-05
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/api/blob.zig
  - src/api/request.zig
  - src/api/fetch.zig
  - src/api/url.zig
  - src/api/abort.zig
autonomous: true

must_haves:
  truths:
    - "blob.size and blob.type read without parentheses (blob.size not blob.size())"
    - "request.url, request.method, request.headers read without parentheses"
    - "response.status, response.ok, response.statusText, response.headers read without parentheses"
    - "url.href, url.origin, url.protocol, url.host, url.hostname, url.port, url.pathname, url.search, url.hash read without parentheses"
    - "abortController.signal read without parentheses"
    - "file.name and file.lastModified read without parentheses"
  artifacts:
    - path: "src/api/blob.zig"
      provides: "Blob.size/type and File.size/type/name/lastModified getter properties"
      contains: "setAccessorGetter"
    - path: "src/api/request.zig"
      provides: "Request.url/method/headers getter properties"
      contains: "setAccessorGetter"
    - path: "src/api/fetch.zig"
      provides: "Response.status/ok/statusText/headers getter properties"
      contains: "setAccessorGetter"
    - path: "src/api/url.zig"
      provides: "URL property getters for all URL components"
      contains: "setAccessorGetter"
    - path: "src/api/abort.zig"
      provides: "AbortController.signal getter property"
      contains: "setAccessorGetter"
  key_links:
    - from: "blob.zig registerBlobAPI"
      to: "blobSizeGetter / blobTypeGetter"
      via: "setAccessorGetter(js.string(isolate, \"size\").toName(), ...)"
      pattern: "setAccessorGetter"
    - from: "request.zig registerRequestAPI"
      to: "requestUrlGetter / requestMethodGetter / requestHeadersGetter"
      via: "setAccessorGetter"
      pattern: "setAccessorGetter"
    - from: "fetch.zig registerFetchAPI"
      to: "responseStatusGetter / responseOkGetter / responseStatusTextGetter / responseHeadersGetter"
      via: "setAccessorGetter (replacing response_proto.set)"
      pattern: "setAccessorGetter"
---

<objective>
Migrate all WinterCG spec-required properties from methods to V8 accessor getters, so standard Workers code can access them without parentheses.

Purpose: Standard Workers code writes `request.url`, `response.status`, `blob.size` — all of these currently require `()` in NANO, breaking any real Workers app.
Output: 11 properties across 5 files converted from `addMethod` / `proto.set()` to `setAccessorGetter()`.
</objective>

<execution_context>
@/Users/gleicon/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gleicon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/v1.2-05-api-spec-compliance/v1.2-05-RESEARCH.md

# Proven getter pattern — copy exactly from:
@src/api/readable_stream.zig
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert Blob.size/type and File.name/lastModified to getter properties</name>
  <files>src/api/blob.zig</files>
  <action>
In `registerBlobAPI`, replace the four `js.addMethod` calls for "size" and "type" on both blob_proto and file_proto with `setAccessorGetter` calls. Also replace "name" and "lastModified" on file_proto.

Pattern to follow (from readable_stream.zig:24-28):
```zig
const size_getter = v8.FunctionTemplate.initCallback(isolate, blobSize);
blob_proto.setAccessorGetter(
    js.string(isolate, "size").toName(),
    size_getter,
);
```

Apply this pattern for:
- blob_proto: "size" -> blobSize, "type" -> blobType
- file_proto: "size" -> blobSize, "type" -> blobType, "name" -> fileName, "lastModified" -> fileLastModified

CRITICAL: Use `.toName()` on the string — without it the property is not recognized.
Keep "text", "arrayBuffer", "slice" as regular methods (they are callable methods per spec).

The existing handler functions (blobSize, blobType, fileName, fileLastModified) already have the correct signature — only the registration changes.
  </action>
  <verify>Build succeeds: `rm -rf /Users/gleicon/code/zig/nano/.zig-cache && zig build -p /Users/gleicon/code/zig/nano/zig-out 2>&1` from /Users/gleicon/code/zig/nano</verify>
  <done>Build completes without errors. blob.size and blob.type are registered via setAccessorGetter (grep confirms "setAccessorGetter" appears in blob.zig).</done>
</task>

<task type="auto">
  <name>Task 2: Convert Request.url/method/headers and Response.status/ok/statusText/headers to getter properties</name>
  <files>src/api/request.zig, src/api/fetch.zig</files>
  <action>
**request.zig:** In `registerRequestAPI`, replace the three `js.addMethod` calls for "url", "method", "headers" with `setAccessorGetter`:
```zig
const url_getter = v8.FunctionTemplate.initCallback(isolate, requestUrl);
request_proto.setAccessorGetter(js.string(isolate, "url").toName(), url_getter);

const method_getter = v8.FunctionTemplate.initCallback(isolate, requestMethod);
request_proto.setAccessorGetter(js.string(isolate, "method").toName(), method_getter);

const headers_getter = v8.FunctionTemplate.initCallback(isolate, requestHeaders);
request_proto.setAccessorGetter(js.string(isolate, "headers").toName(), headers_getter);
```
Keep "text" and "json" as regular methods.

**fetch.zig:** In `registerFetchAPI`, the Response properties status, ok, statusText, headers currently use `response_proto.set(v8.String.initUtf8(isolate, "status").toName(), status_fn, ...)`. Replace with `setAccessorGetter`:
```zig
const status_getter = v8.FunctionTemplate.initCallback(isolate, responseStatus);
response_proto.setAccessorGetter(v8.String.initUtf8(isolate, "status").toName(), status_getter);
```
Apply same pattern to ok, statusText, headers.

NOTE: response_proto.body is already correctly using setAccessorGetter — do NOT touch it.
Keep text, json as regular methods.

CRITICAL: Use `.toName()` on every property name string.
  </action>
  <verify>Build succeeds: `rm -rf /Users/gleicon/code/zig/nano/.zig-cache && zig build -p /Users/gleicon/code/zig/nano/zig-out 2>&1` from /Users/gleicon/code/zig/nano</verify>
  <done>Build completes without errors. request.zig and fetch.zig both contain setAccessorGetter for url/method/headers and status/ok/statusText/headers respectively.</done>
</task>

<task type="auto">
  <name>Task 3: Convert URL component properties and AbortController.signal to getter properties</name>
  <files>src/api/url.zig, src/api/abort.zig</files>
  <action>
**src/api/url.zig:** In `registerURLAPIs`, replace ALL `js.addMethod` calls for url properties with `setAccessorGetter`:
- "href" -> urlGetHref
- "origin" -> urlGetOrigin
- "protocol" -> urlGetProtocol
- "host" -> urlGetHost
- "hostname" -> urlGetHostname
- "port" -> urlGetPort
- "pathname" -> urlGetPathname
- "search" -> urlGetSearch
- "hash" -> urlGetHash

Keep "toString" as a regular method (it is a callable method per spec, not a getter).

Pattern:
```zig
const href_getter = v8.FunctionTemplate.initCallback(isolate, urlGetHref);
url_proto.setAccessorGetter(js.string(isolate, "href").toName(), href_getter);
```

**src/api/abort.zig:** In `registerAbortAPI`, replace `js.addMethod(controller_proto, isolate, "signal", controllerSignal)` with:
```zig
const signal_getter = v8.FunctionTemplate.initCallback(isolate, controllerSignal);
controller_proto.setAccessorGetter(js.string(isolate, "signal").toName(), signal_getter);
```
Keep "abort" as a regular method.

CRITICAL: Use `.toName()` on every property name string.
  </action>
  <verify>Build succeeds: `rm -rf /Users/gleicon/code/zig/nano/.zig-cache && zig build -p /Users/gleicon/code/zig/nano/zig-out 2>&1` from /Users/gleicon/code/zig/nano</verify>
  <done>Build completes without errors. url.zig contains 9 setAccessorGetter calls. abort.zig contains setAccessorGetter for "signal".</done>
</task>

</tasks>

<verification>
After all three tasks:
1. `grep -c "setAccessorGetter" src/api/blob.zig` returns >= 4 (size x2, type x2 for Blob and File)
2. `grep -c "setAccessorGetter" src/api/request.zig` returns >= 3
3. `grep -c "setAccessorGetter" src/api/fetch.zig` returns >= 5 (body already there + 4 new)
4. `grep -c "setAccessorGetter" src/api/url.zig` returns >= 9
5. `grep -c "setAccessorGetter" src/api/abort.zig` returns >= 1
6. `zig build` succeeds
</verification>

<success_criteria>
All 11 properties (Blob.size, Blob.type, File.size, File.type, File.name, File.lastModified, Request.url, Request.method, Request.headers, Response.status, Response.ok, Response.statusText, Response.headers, URL.href/origin/protocol/host/hostname/port/pathname/search/hash, AbortController.signal) are registered via setAccessorGetter, not addMethod or proto.set. Build passes.
</success_criteria>

<output>
After completion, create `.planning/phases/v1.2-05-api-spec-compliance/v1.2-05-01-SUMMARY.md`
</output>
