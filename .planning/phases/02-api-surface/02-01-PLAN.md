---
phase: 02-api-surface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/api/console.zig
  - src/engine/context.zig
  - src/main.zig
autonomous: true

must_haves:
  truths:
    - "console.log() output appears on stdout"
    - "console.error() output appears on stderr"
    - "console.warn() output appears on stderr with prefix"
    - "Multiple arguments are space-separated"
  artifacts:
    - path: "src/api/console.zig"
      provides: "Console API bindings"
      exports: ["registerConsole"]
---

<objective>
Implement console.log/error/warn APIs that output to host process stdout/stderr.

Purpose: Essential for debugging and the REPL. Console output is the primary way scripts communicate with developers.

Output: Console object bound to V8 global with log/error/warn methods.
</objective>

<context>
V8 allows binding native functions to JavaScript via FunctionTemplate.
Pattern: Create JS function that calls Zig callback, callback writes to stdout/stderr.

Key V8 APIs:
- `FunctionTemplate.init()` - create callable template
- `ObjectTemplate.set()` - add property to object
- `Context.getGlobal()` - get global object
- Function callback receives `FunctionCallbackInfo` with arguments
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create console API module</name>
  <files>src/api/console.zig</files>
  <action>
Create the console API implementation that binds to V8.

Key implementation:
1. Create `console` object template with log/error/warn methods
2. Each method extracts arguments, converts to strings, writes to stdout/stderr
3. Register on global object before script execution
  </action>
  <verify>
Build succeeds with new module.
  </verify>
</task>

<task type="auto">
  <name>Task 2: Integrate console into script execution</name>
  <files>src/engine/script.zig</files>
  <action>
Modify runScript to register console API on the context's global object
before compiling/running the script.
  </action>
  <verify>
`nano eval "console.log('hello')"` prints "hello" to stdout.
`nano eval "console.error('oops')"` prints "oops" to stderr.
  </verify>
</task>

</tasks>

<success_criteria>
- `console.log('a', 'b')` prints "a b" to stdout
- `console.error('err')` prints "err" to stderr
- `console.warn('warn')` prints "[WARN] warn" to stderr
- Works with any JS value (numbers, objects, arrays)
</success_criteria>
