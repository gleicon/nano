# Plan 02-02: Encoding APIs

## Goal
Implement TextEncoder, TextDecoder, atob(), and btoa() for Workers API compatibility.

## Context
- Workers scripts need to encode/decode text (UTF-8) and binary data (base64)
- These are fundamental APIs used by nearly all web applications
- Implementation in Zig for performance, exposed to JS via V8 bindings

## Success Criteria
1. `new TextEncoder().encode('hello')` returns Uint8Array
2. `new TextDecoder().decode(bytes)` returns string
3. `btoa('hello')` returns base64 string
4. `atob('aGVsbG8=')` returns decoded string

## Implementation

### Files to Create/Modify

1. **src/api/encoding.zig** (NEW)
   - TextEncoder class with encode() method
   - TextDecoder class with decode() method
   - Global atob() and btoa() functions

2. **build.zig** (MODIFY)
   - Add encoding module

3. **src/repl.zig** (MODIFY)
   - Register encoding APIs

4. **src/engine/script.zig** (MODIFY)
   - Register encoding APIs for eval

### Technical Approach

**TextEncoder:**
- V8 FunctionTemplate as constructor
- encode() returns V8 Uint8Array from UTF-8 bytes
- Zig's std.unicode handles edge cases

**TextDecoder:**
- Constructor accepts optional encoding label (default: "utf-8")
- decode() converts Uint8Array to V8 String
- Only UTF-8 supported initially (Workers primary use case)

**atob/btoa:**
- Global functions on global object
- Use Zig's std.base64 for encoding/decoding
- Handle invalid input with proper errors

### Verification
```javascript
// TextEncoder
const encoder = new TextEncoder();
const bytes = encoder.encode('hello');
console.log(bytes.length); // 5

// TextDecoder
const decoder = new TextDecoder();
const text = decoder.decode(bytes);
console.log(text); // "hello"

// Base64
console.log(btoa('hello')); // "aGVsbG8="
console.log(atob('aGVsbG8=')); // "hello"
```

## Tasks
1. Create src/api/encoding.zig with base64 functions
2. Add TextEncoder/TextDecoder constructors
3. Wire up to build system
4. Register in script.zig and repl.zig
5. Test all functions

## Risks
- V8 TypedArray API may have edge cases
- Base64 padding handling

## Duration
Estimated: 1 plan
