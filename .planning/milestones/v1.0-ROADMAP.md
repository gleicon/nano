# Milestone v1.0: MVP

**Status:** SHIPPED 2026-01-26
**Phases:** 1-6
**Total Plans:** 14

## Overview

NANO v1.0 is an ultra-dense JavaScript runtime that hosts applications using V8 isolates in a single Zig process. Built in six phases following the natural dependency chain: V8 foundation, Workers-compatible APIs, HTTP multi-app hosting, script caching, production hardening, and async runtime.

**Core Value:** Skip the container fleet entirely — one NANO process replaces dozens of Node containers.

## Phases

### Phase 1: V8 Foundation
**Goal**: Zig can execute JavaScript code via V8 with per-request memory management
**Depends on**: Nothing (first phase)
**Requirements**: CORE-01, CORE-02
**Success Criteria** (what must be TRUE):
  1. Running `nano eval "1 + 1"` returns `2` to stdout
  2. JavaScript syntax errors return meaningful error messages
  3. Memory allocated during script execution is freed when request ends
**Plans**: 3 plans

Plans:
- [x] 01-01-PLAN.md — Project setup and V8 integration via zig-v8-fork
- [x] 01-02-PLAN.md — Script execution with TryCatch error handling
- [x] 01-03-PLAN.md — CLI interface and arena allocator integration

### Phase 2: API Surface
**Goal**: Scripts have access to Workers-compatible APIs (fetch, crypto, console, streams) + REPL for development
**Depends on**: Phase 1
**Requirements**: WAPI-01, WAPI-02, WAPI-03, WAPI-04, WAPI-05, WAPI-06, HTTP-01, HTTP-02, HTTP-03, HTTP-04, HTTP-05, HTTP-06, HTTP-07, CRYP-01, CRYP-02, CRYP-03, CRYP-04
**Success Criteria** (what must be TRUE):
  1. Script can fetch an external URL and read the response body
  2. Script can compute SHA-256 hash via crypto.subtle.digest()
  3. console.log output appears in host process logs
  4. Script can encode/decode text, base64, and URL parameters
  5. `nano repl` starts interactive JavaScript session
**Plans**: 5 plans

Plans:
- [x] 02-01-PLAN.md — Console API (console.log/error/warn)
- [x] 02-02-PLAN.md — Encoding APIs (TextEncoder/Decoder, atob/btoa)
- [x] 02-03-PLAN.md — URL APIs (URL, URLSearchParams)
- [x] 02-04-PLAN.md — REPL command with persistent isolate
- [x] 02-05-PLAN.md — Crypto and Fetch APIs (stub, async requires Phase 3)

### Phase 3: Multi-App Hosting
**Goal**: Multiple apps run on the same NANO process, routed by port
**Depends on**: Phase 2
**Requirements**: HOST-01, HOST-02, HOST-03, OBSV-02
**Success Criteria** (what must be TRUE):
  1. Pointing NANO at a folder starts an app serving HTTP requests
  2. Two apps on different ports run independently without interference
  3. HTTP errors return proper status codes (4xx, 5xx) with clean messages
**Plans**: 3 plans

Plans:
- [x] 03-01-PLAN.md — HTTP Server Foundation
- [x] 03-02-PLAN.md — Request/Response/Headers APIs
- [x] 03-03-PLAN.md — App Loader and JavaScript Handler Integration

Note: HOST-02 (multi-app registry) deferred to post-v1.0. Single-app hosting is the MVP.

### Phase 4: Snapshots + Pooling
**Goal**: Cold starts under 5ms via V8 snapshots and warm isolate pooling
**Depends on**: Phase 3
**Requirements**: CORE-03, CORE-04
**Success Criteria** (what must be TRUE):
  1. p99 cold start latency is under 5ms (measured, not estimated)
  2. Warm isolates are reused for subsequent requests to same app
  3. Snapshot contains all Phase 2 APIs pre-initialized
**Plans**: 1 plan (2 deferred)

Plans:
- [x] 04-01-PLAN.md — Script Caching (compile once, reuse per request)
- [ ] 04-02-PLAN.md — V8 Snapshots (deferred - callback serialization complex)
- [ ] 04-03-PLAN.md — Isolate Pooling (deferred - single-threaded for v1.0)

### Phase 5: Production Hardening
**Goal**: NANO has production-ready observability
**Depends on**: Phase 4
**Requirements**: OBSV-01, OBSV-03
**Success Criteria** (what must be TRUE):
  1. Structured logs include app name, request ID, and timestamp
  2. Prometheus endpoint exposes request count, error count, and latency metrics
  3. Health endpoints return status for load balancer probes
  4. Graceful shutdown handles SIGTERM/SIGINT
**Plans**: 1 plan

Plans:
- [x] 05-01-PLAN.md — Logging, metrics, health endpoints, graceful shutdown

### Phase 6: Async Runtime
**Goal**: NANO supports async JavaScript with event loop and timers
**Depends on**: Phase 5
**Requirements**: WAPI-05, HTTP-04 (async)
**Success Criteria** (what must be TRUE):
  1. setTimeout/setInterval execute callbacks after delay
  2. clearTimeout/clearInterval cancel pending timers
  3. fetch() returns a Promise that resolves with Response
  4. async/await works in request handlers
**Plans**: 1 plan

Plans:
- [x] 06-01-PLAN.md — Event loop (libxev), timers, async fetch, Promise handlers

## Milestone Summary

### Key Decisions

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Zig over Rust | Better C++ interop, arena allocators | Good |
| V8 over JSC | Better documented embedding, snapshot system | Good |
| Workers API over Node API | Simpler surface, isolation-friendly, portable | Good |
| Ports-first routing | Simple start, external proxy handles SSL/vhosts | Good |
| Script caching over snapshots | Snapshots too complex for v1 (callback serialization) | Good |
| Single-threaded MVP | Isolate pooling deferred to v2 | Good |

### Items Deferred to v2

| Item | Reason | Original Requirement |
|------|--------|---------------------|
| V8 Snapshots | Callback serialization complex | CORE-03 |
| Isolate Pooling | Single-threaded for v1.0 | CORE-04 |
| Multi-App Registry | Single-app MVP sufficient | HOST-02 |
| Per-App Config | Config file format (JSON/TOML) | RLIM-03 |
| Streams API | Complex, rarely needed for Workers | WAPI-06 |

### Bonus v2 Features Shipped Early

| Feature | Implementation |
|---------|----------------|
| RLIM-02 CPU Watchdog | Separate thread with V8 TerminateExecution (5s timeout) |
| RLIM-01 Memory Limits | V8 ResourceConstraints (128MB default) |
| HTTP-05 AbortController | AbortController/AbortSignal with abort(), aborted(), reason() |
| HTTP-06/07 FormData/Blob/File | Blob with base64 storage, File extends Blob, FormData with append/get/set |
| CRYP-04 crypto.subtle.sign/verify | HMAC-SHA256/384/512 signing and verification |

### Tech Debt Incurred

1. **REPL Missing Timer Support** — setTimeout/setInterval throw "Event loop not initialized" in REPL (LOW)
2. **TextDecoder TypedArray Limitation** — decode() only accepts string, not TypedArray/ArrayBuffer (LOW)
3. **Response Headers Limited** — Only extracts content-type, custom headers not forwarded (MEDIUM)

### Stats

- **Phases:** 6
- **Plans:** 14
- **Files:** 85 created/modified
- **Lines of Zig:** 6,261 LOC
- **Commits:** 15
- **Timeline:** 8 days (2026-01-18 → 2026-01-26)
- **Git range:** 227e3f3 → 08688c8

---
*Archived: 2026-01-26 as part of v1.0 milestone completion*
