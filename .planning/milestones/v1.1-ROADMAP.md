# Milestone v1.1: Multi-App Hosting

**Status:** SHIPPED 2026-02-01
**Phases:** 1-2 (v1.1 scope)
**Total Plans:** 3

## Overview

Transform NANO from single-app to multi-app runtime with virtual host routing on a single port.

**Target features:**
- Multi-app registry (load multiple apps from config)
- Virtual host routing (Host header -> app routing on same port)
- Per-app configuration (limits, entry point)
- Hot reload without restart

## Phases

### Phase 1: Multi-App Virtual Host Routing

**Goal:** HttpServer holds and routes to multiple apps based on Host header.
**Requirements:** MULTI-01, MULTI-02
**Plans:** 1 plan

Plans:
- [x] 01-PLAN.md - Multi-app virtual host routing

**Key changes:**
- `HttpServer.apps` as HashMap (host -> App)
- Parse Host header from incoming requests
- Route request to correct app based on Host
- Default app for unmatched hosts

**Success criteria:**
- [x] Two apps loaded from config
- [x] Request with `Host: app-a.local` routes to app-a
- [x] Request with `Host: app-b.local` routes to app-b
- [x] Unknown hosts get default response

**Details:**
- Extended config parser with `hostname` field for AppConfig
- Host header parsed case-insensitively
- Port stripped from Host value (e.g., "app.local:8080" -> "app.local")
- First app in config becomes default for unmatched hosts
- Each app maintains separate V8 isolate for memory isolation

---

### Phase 2: App Lifecycle & Hot Reload

**Goal:** Support app addition/removal without server restart.
**Requirements:** MULTI-03
**Plans:** 2 plans

Plans:
- [x] 02-01-PLAN.md - Config file watcher and reload infrastructure
- [x] 02-02-PLAN.md - Admin API endpoints for app management

**Key changes:**
- Poll-based config watcher (2s interval, 500ms debounce)
- Add/remove apps via Admin API endpoints
- Atomic config reload without request drops

**Success criteria:**
- [x] `/admin/apps` endpoint lists loaded apps
- [x] Config file change triggers reload
- [x] No request drops during reload

**Details:**
- ConfigWatcher uses xev.Timer for async polling
- Function pointer callback pattern avoids circular imports
- Admin API at `/admin/*` prefix for clear separation
- Fixed buffer JSON for allocation-free responses
- Last app protected from deletion

---

## Milestone Summary

**Key Decisions:**
- Decision: Poll-based config watching (Rationale: libxev lacks filesystem events)
- Decision: Function pointer callback pattern (Rationale: Avoid circular imports)
- Decision: Admin /admin/* prefix routing (Rationale: Clear separation, easy to gate)
- Decision: Fixed buffer JSON building (Rationale: No allocation for small responses)
- Decision: Protect last app from deletion (Rationale: Server needs at least one app)

**Issues Resolved:**
- Fixed i128 type mismatch for nanosecond timestamps
- Fixed ArrayList API change for Zig 0.15 compatibility

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- TODO: Handle changed apps (same hostname, different path) - INFO severity

---

## Requirements Traceability

| REQ-ID | Requirement | Phase | Status |
|--------|-------------|-------|--------|
| MULTI-01 | Load multiple apps from config | 1 | Complete |
| MULTI-02 | Route by Host header on single port | 1 | Complete |
| MULTI-03 | Hot reload apps without restart | 2 | Complete |

---

## Statistics

- **Files modified:** 20
- **Lines added:** +2,607
- **Phases:** 2
- **Plans:** 3
- **Timeline:** 14 days (2026-01-18 -> 2026-02-01)
- **Git range:** `362347d` -> `d9d29a2`

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-02-01*
